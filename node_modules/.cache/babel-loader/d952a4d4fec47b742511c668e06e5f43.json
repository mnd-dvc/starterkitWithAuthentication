{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\nvar React = require('react');\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n  return target;\n}\nfunction findCommentNode(comment) {\n  var head = document.head;\n  for (var i = 0; i < head.childNodes.length; i++) {\n    var _node$nodeValue;\n    var node = head.childNodes[i];\n    if (node.nodeType === 8 && (node === null || node === void 0 ? void 0 : (_node$nodeValue = node.nodeValue) === null || _node$nodeValue === void 0 ? void 0 : _node$nodeValue.trim()) === comment) {\n      return node;\n    }\n  }\n  return null;\n}\nfunction arrayToObject(array) {\n  var obj = {};\n  array.forEach(function (el) {\n    return obj[el] = el;\n  });\n  return obj;\n}\nfunction createLinkElement(attributes) {\n  var linkElement = document.createElement('link');\n  for (var _i = 0, _Object$entries = Object.entries(attributes); _i < _Object$entries.length; _i++) {\n    var _Object$entries$_i = _Object$entries[_i],\n      attribute = _Object$entries$_i[0],\n      value = _Object$entries$_i[1];\n    if (attribute === 'onload') {\n      linkElement.onload = attributes.onload;\n      continue;\n    } // @ts-ignore\n\n    linkElement[attribute] = value;\n  }\n  return linkElement;\n}\nvar Status;\n(function (Status) {\n  Status[\"idle\"] = \"idle\";\n  Status[\"loading\"] = \"loading\";\n  Status[\"loaded\"] = \"loaded\";\n})(Status || (Status = {}));\nvar ThemeSwitcherContext = /*#__PURE__*/React.createContext(undefined);\nfunction ThemeSwitcherProvider(_ref) {\n  var themeMap = _ref.themeMap,\n    insertionPoint = _ref.insertionPoint,\n    defaultTheme = _ref.defaultTheme,\n    _ref$id = _ref.id,\n    id = _ref$id === void 0 ? 'current-theme-style' : _ref$id,\n    _ref$attr = _ref.attr,\n    attr = _ref$attr === void 0 ? 'data-theme' : _ref$attr,\n    rest = _objectWithoutPropertiesLoose(_ref, [\"themeMap\", \"insertionPoint\", \"defaultTheme\", \"id\", \"attr\"]);\n  var _React$useState = React.useState(Status.idle),\n    status = _React$useState[0],\n    setStatus = _React$useState[1];\n  var _React$useState2 = React.useState(),\n    currentTheme = _React$useState2[0],\n    setCurrentTheme = _React$useState2[1];\n  var insertStyle = React.useCallback(function (linkElement) {\n    if (insertionPoint) {\n      var insertionPointElement = findCommentNode(insertionPoint);\n      if (!insertionPointElement) {\n        console.warn(\"Insertion point '\" + insertionPoint + \"' does not exist. Be sure to add comment on head and that it matches the insertionPoint\");\n        return document.head.appendChild(linkElement);\n      }\n      var parentNode = insertionPointElement.parentNode;\n      if (parentNode) {\n        return parentNode.insertBefore(linkElement, insertionPointElement.nextSibling);\n      }\n    } else {\n      return document.head.appendChild(linkElement);\n    }\n  }, [insertionPoint]);\n  var switcher = React.useCallback(function (_ref2) {\n    var theme = _ref2.theme;\n    if (theme === currentTheme) return;\n    var previousStyle = document.getElementById(id);\n    if (previousStyle) {\n      previousStyle.remove();\n    }\n    if (themeMap[theme]) {\n      setStatus(Status.loading);\n      var linkElement = createLinkElement({\n        type: 'text/css',\n        rel: 'stylesheet',\n        id: id,\n        href: themeMap[theme],\n        onload: function onload() {\n          setStatus(Status.loaded);\n        }\n      });\n      insertStyle(linkElement);\n      setCurrentTheme(theme);\n    } else {\n      return console.warn('Could not find specified theme');\n    }\n    document.body.setAttribute(attr, theme);\n  }, [themeMap, insertStyle, attr, id, currentTheme]);\n  React.useEffect(function () {\n    if (defaultTheme) {\n      switcher({\n        theme: defaultTheme\n      });\n    }\n  }, [defaultTheme]);\n  React.useEffect(function () {\n    var themes = Object.keys(themeMap);\n    themes.map(function (theme) {\n      var themeAssetId = \"theme-prefetch-\" + theme;\n      if (!document.getElementById(themeAssetId)) {\n        var stylePrefetch = document.createElement('link');\n        stylePrefetch.rel = 'prefetch';\n        stylePrefetch.type = 'text/css';\n        stylePrefetch.id = themeAssetId;\n        stylePrefetch.href = themeMap[theme];\n        insertStyle(stylePrefetch);\n      }\n      return '';\n    });\n  }, [themeMap, insertStyle]);\n  var value = React.useMemo(function () {\n    return {\n      switcher: switcher,\n      status: status,\n      currentTheme: currentTheme,\n      themes: arrayToObject(Object.keys(themeMap))\n    };\n  }, [switcher, status, currentTheme, themeMap]);\n  return React.createElement(ThemeSwitcherContext.Provider, Object.assign({\n    value: value\n  }, rest));\n}\nfunction useThemeSwitcher() {\n  var context = React.useContext(ThemeSwitcherContext);\n  if (!context) {\n    throw new Error('To use `useThemeSwitcher`, component must be within a ThemeSwitcherProvider');\n  }\n  return context;\n}\nexports.ThemeSwitcherProvider = ThemeSwitcherProvider;\nexports.useThemeSwitcher = useThemeSwitcher;","map":{"version":3,"names":["findCommentNode","comment","head","document","i","childNodes","length","_node$nodeValue","node","nodeType","nodeValue","trim","arrayToObject","array","obj","forEach","el","createLinkElement","attributes","linkElement","createElement","_i","_Object$entries","Object","entries","_Object$entries$_i","attribute","value","onload","Status","ThemeSwitcherContext","React","createContext","undefined","ThemeSwitcherProvider","_ref","themeMap","insertionPoint","defaultTheme","id","_ref$id","attr","_ref$attr","rest","_objectWithoutPropertiesLoose","useState","idle","status","_React$useState","setStatus","currentTheme","_React$useState2","setCurrentTheme","insertStyle","useCallback","insertionPointElement","console","warn","appendChild","parentNode","insertBefore","nextSibling","switcher","_ref2","theme","previousStyle","getElementById","remove","loading","type","rel","href","loaded","body","setAttribute","useEffect","themes","keys","map","themeAssetId","stylePrefetch","useMemo","Provider","assign","useThemeSwitcher","context","useContext","Error"],"sources":["../src/utils.ts","../src/index.tsx"],"sourcesContent":["export function findCommentNode(comment: string) {\n  const head = document.head;\n  for (let i = 0; i < head.childNodes.length; i++) {\n    const node = head.childNodes[i];\n    if (node.nodeType === 8 && node?.nodeValue?.trim() === comment) {\n      return node;\n    }\n  }\n  return null;\n}\n\nexport function arrayToObject(array: string[]): Record<any, string> {\n  const obj: Record<any, string> = {};\n  array.forEach(el => (obj[el] = el));\n  return obj;\n}\n\nexport function createLinkElement(attributes: Record<string, any>) {\n  const linkElement = document.createElement('link');\n\n  for (const [attribute, value] of Object.entries(attributes)) {\n    if (attribute === 'onload') {\n      linkElement.onload = attributes.onload;\n      continue;\n    }\n\n    // @ts-ignore\n    linkElement[attribute] = value;\n  }\n\n  return linkElement;\n}\n","import * as React from 'react';\nimport { findCommentNode, arrayToObject, createLinkElement } from './utils';\n\nenum Status {\n  idle = 'idle',\n  loading = 'loading',\n  loaded = 'loaded',\n}\n\ninterface IThemeSwitcherContext {\n  currentTheme: string | undefined;\n  themes: Record<any, string>;\n  switcher: ({ theme }: { theme: string }) => void;\n  status: Status;\n}\n\nconst ThemeSwitcherContext = React.createContext<\n  IThemeSwitcherContext | undefined\n>(undefined);\n\ninterface Props {\n  themeMap: Record<any, string>;\n  children?: React.ReactNode;\n  insertionPoint?: string;\n  id?: string;\n  defaultTheme?: string;\n  attr?: string;\n}\n\nexport function ThemeSwitcherProvider({\n  themeMap,\n  insertionPoint,\n  defaultTheme,\n  id = 'current-theme-style',\n  attr = 'data-theme',\n  ...rest\n}: Props) {\n  const [status, setStatus] = React.useState<Status>(Status.idle);\n  const [currentTheme, setCurrentTheme] = React.useState<string>();\n\n  const insertStyle = React.useCallback(\n    (linkElement: HTMLElement): HTMLElement | void => {\n      if (insertionPoint) {\n        const insertionPointElement = findCommentNode(insertionPoint);\n\n        if (!insertionPointElement) {\n          console.warn(\n            `Insertion point '${insertionPoint}' does not exist. Be sure to add comment on head and that it matches the insertionPoint`\n          );\n          return document.head.appendChild(linkElement);\n        }\n\n        const { parentNode } = insertionPointElement;\n        if (parentNode) {\n          return parentNode.insertBefore(\n            linkElement,\n            insertionPointElement.nextSibling\n          );\n        }\n      } else {\n        return document.head.appendChild(linkElement);\n      }\n    },\n    [insertionPoint]\n  );\n\n  const switcher = React.useCallback(\n    ({ theme }: { theme: string }) => {\n      if (theme === currentTheme) return;\n\n      const previousStyle = document.getElementById(id);\n      if (previousStyle) {\n        previousStyle.remove();\n      }\n\n      if (themeMap[theme]) {\n        setStatus(Status.loading);\n\n        const linkElement = createLinkElement({\n          type: 'text/css',\n          rel: 'stylesheet',\n          id: id,\n          href: themeMap[theme],\n          onload: () => {\n            setStatus(Status.loaded);\n          },\n        });\n\n        insertStyle(linkElement);\n        setCurrentTheme(theme);\n      } else {\n        return console.warn('Could not find specified theme');\n      }\n\n      document.body.setAttribute(attr, theme);\n    },\n    [themeMap, insertStyle, attr, id, currentTheme]\n  );\n\n  React.useEffect(() => {\n    if (defaultTheme) {\n      switcher({ theme: defaultTheme });\n    }\n  }, [defaultTheme]);\n\n  React.useEffect(() => {\n    const themes = Object.keys(themeMap);\n\n    themes.map(theme => {\n      const themeAssetId = `theme-prefetch-${theme}`;\n      if (!document.getElementById(themeAssetId)) {\n        const stylePrefetch = document.createElement('link');\n        stylePrefetch.rel = 'prefetch';\n        stylePrefetch.type = 'text/css';\n        stylePrefetch.id = themeAssetId;\n        stylePrefetch.href = themeMap[theme];\n\n        insertStyle(stylePrefetch);\n      }\n      return '';\n    });\n  }, [themeMap, insertStyle]);\n\n  const value = React.useMemo(\n    () => ({\n      switcher,\n      status,\n      currentTheme,\n      themes: arrayToObject(Object.keys(themeMap)),\n    }),\n    [switcher, status, currentTheme, themeMap]\n  );\n\n  return <ThemeSwitcherContext.Provider value={value} {...rest} />;\n}\n\nexport function useThemeSwitcher() {\n  const context = React.useContext(ThemeSwitcherContext);\n  if (!context) {\n    throw new Error(\n      'To use `useThemeSwitcher`, component must be within a ThemeSwitcherProvider'\n    );\n  }\n  return context;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}